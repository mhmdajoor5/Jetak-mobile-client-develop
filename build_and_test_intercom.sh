#!/bin/bash

# ุณูุฑูุจุช ูุจูุงุก ูุงุฎุชุจุงุฑ ุญู ูุดููุฉ Intercom ุนูู Android
# Build and Test Intercom Fix Script

echo "๐ ุจุฏุก ุนูููุฉ ุจูุงุก ูุงุฎุชุจุงุฑ ุญู Intercom..."

# ุชูุธูู ุงูุจูุงุก ุงูุณุงุจู
echo "๐งน ุชูุธูู ุงูุจูุงุก ุงูุณุงุจู..."
flutter clean

# ุชุญุฏูุซ ุงูุชุจุนูุงุช
echo "๐ฆ ุชุญุฏูุซ ุงูุชุจุนูุงุช..."
flutter pub get

# ุจูุงุก ุงูุฅุตุฏุงุฑ ุงููุทูู
echo "๐จ ุจูุงุก ุงูุฅุตุฏุงุฑ ุงููุทูู..."
flutter build apk --release

# ุงูุชุญูู ูู ูุฌุงุญ ุงูุจูุงุก
if [ $? -eq 0 ]; then
    echo "โ ุชู ุจูุงุก ุงูุชุทุจูู ุจูุฌุงุญ!"
    
    # ุชุซุจูุช ุงูุชุทุจูู ุนูู ุงูุฌูุงุฒ ุงููุชุตู
    echo "๐ฑ ุชุซุจูุช ุงูุชุทุจูู ุนูู ุงูุฌูุงุฒ..."
    flutter install --release
    
    if [ $? -eq 0 ]; then
        echo "โ ุชู ุชุซุจูุช ุงูุชุทุจูู ุจูุฌุงุญ!"
        
        # ุนุฑุถ ูุนูููุงุช ุงูุฌูุงุฒ
        echo "๐ ูุนูููุงุช ุงูุฌูุงุฒ:"
        adb devices
        
        # ูุฑุงูุจุฉ ุณุฌูุงุช Intercom
        echo "๐ ูุฑุงูุจุฉ ุณุฌูุงุช Intercom (ุงุถุบุท Ctrl+C ูุฅููุงู):"
        echo "๐ ุงุจุญุซ ุนู ุฑุณุงุฆู 'IntercomDebug' ูู ุงูุณุฌูุงุช"
        adb logcat | grep -E "(IntercomDebug|Intercom|intercom)"
        
    else
        echo "โ ูุดู ูู ุชุซุจูุช ุงูุชุทุจูู"
        echo "๐ก ุชุฃูุฏ ูู ุชูุตูู ุฌูุงุฒ Android ุฃู ุชุดุบูู ูุญุงูู"
    fi
else
    echo "โ ูุดู ูู ุจูุงุก ุงูุชุทุจูู"
    echo "๐ ุชุญูู ูู ุงูุฃุฎุทุงุก ูู ุงูุจูุงุก ุฃุนูุงู"
fi

echo "๐ ุงูุชูุช ุนูููุฉ ุงูุจูุงุก ูุงูุงุฎุชุจุงุฑ"
