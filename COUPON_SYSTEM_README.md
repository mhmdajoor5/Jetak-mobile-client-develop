# ูุธุงู ุงูููุจูู - Coupon System

## โ ุงูููุฒุงุช ุงููุทุจูุฉ:

### 1. **ุชุทุจูู ุงูููุจูู ูู API**
- ุฌูุจ ุจูุงูุงุช ุงูููุจูู ูู ุงูุฎุงุฏู ุนุจุฑ `verifyCoupon()`
- ุงูุชุญูู ูู ุตุญุฉ ุงูููุจูู (`valid`)
- ุงูุชุญูู ูู ุฃู ุงูููุจูู ููุทุจู ุนูู ุงููุทุนู ุงูุญุงูู

### 2. **ุญุณุงุจ ุงูุฎุตู ุจุดูู ุตุญูุญ**
- **ุฎุตู ุซุงุจุช (Fixed)**: ุฎุตู ูุจูุบ ูุญุฏุฏ (ูุซู 5 ุฏููุงุฑ)
- **ุฎุตู ูุณุจู (Percent)**: ุฎุตู ูุณุจุฉ ูุฆููุฉ (ูุซู 10%)
- ุงูุชุฃูุฏ ูู ุฃู ุงูุฎุตู ูุง ูุชุฌุงูุฒ ุงูุณุนุฑ ุงูุฅุฌูุงูู

### 3. **ูุงุฌูุฉ ุงููุณุชุฎุฏู**
- ุญูู ุฅุฏุฎุงู ุงูููุจูู ูู ุตูุญุฉ Delivery/Pickup
- ุนุฑุถ ุงูููุจูู ุงููุทุจู ูุน ุฅููุงููุฉ ุฅุฒุงูุชู
- ุฑุณุงุฆู ุชุฃููุฏ ูุฃุฎุทุงุก ูุงุถุญุฉ

### 4. **ุนุฑุถ ุงูุฎุตู ูู Order Summary**
- ุฅุธูุงุฑ "ุฎุตู ุงูููุจูู" ูู ููุฎุต ุงูุทูุจ
- ุนุฑุถ ูููุฉ ุงูุฎุตู ูููุนู (ุซุงุจุช ุฃู ูุณุจู)

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ:

### 1. **`lib/src/controllers/cart_controller.dart`**
```dart
// ุญุณุงุจ ุงูุฎุตู ูู calculateSubtotal()
double couponDiscount = 0.0;
if (coupon.valid == true && coupon.discount != null) {
  if (coupon.discountType == 'fixed') {
    couponDiscount = coupon.discount!;
  } else if (coupon.discountType == 'percent') {
    couponDiscount = subTotal * (coupon.discount! / 100);
  }
  // ุงูุชุฃูุฏ ูู ุฃู ุงูุฎุตู ูุง ูุชุฌุงูุฒ ุงูุณุนุฑ ุงูุฅุฌูุงูู
  if (couponDiscount > subTotal) {
    couponDiscount = subTotal;
  }
}

// ุชุทุจูู ุงูููุจูู ูู API
void doApplyCoupon(String code) async {
  // ุฌูุจ ุจูุงูุงุช ุงูููุจูู ูู API
  Stream<Coupon> couponStream = await verifyCoupon(code);
  
  // ุงูุชุญูู ูู ุตุญุฉ ุงูููุจูู
  // ุงูุชุญูู ูู ุชุทุจูู ุงูููุจูู ุนูู ุงููุทุนู ุงูุญุงูู
  // ุชุทุจูู ุงูุฎุตู
}
```

### 2. **`lib/src/pages/delivery_pickup.dart`**
- ุญูู ุฅุฏุฎุงู ุงูููุจูู ูุน ุฒุฑ ุงูุชุทุจูู
- ุนุฑุถ ุงูููุจูู ุงููุทุจู
- ุฅุฏุงุฑุฉ ุญุงูุฉ ุงูุชุญููู

### 3. **`lib/src/elements/CartBottomDetailsWidget.dart`**
- ุนุฑุถ "ุฎุตู ุงูููุจูู" ูู ููุฎุต ุงูุทูุจ

### 4. **`lib/src/models/order.dart`**
- ุฅุถุงูุฉ `Coupon? coupon` ููุทูุจ
- ุฅุฑุณุงู `coupon_code` ููุฎุงุฏู

## ๐ง ููููุฉ ุงูุงุณุชุฎุฏุงู:

### 1. **ุชุทุจูู ุงูููุจูู:**
```
1. ุงูุชูู ุฅูู ุตูุญุฉ Delivery/Pickup
2. ุงุจุญุซ ุนู ุญูู "Add a promo code"
3. ุฃุฏุฎู ุฑูุฒ ุงูููุจูู
4. ุงุถุบุท "ุชุทุจูู" ุฃู Enter
5. ุงูุชุธุฑ ุงูุชุญูู ูู API
6. ุดุงูุฏ ุงูุฎุตู ูู Order Summary
```

### 2. **ุฅุฒุงูุฉ ุงูููุจูู:**
```
ุงุถุบุท ุนูู ุฒุฑ "ุฅุฒุงูุฉ" ุจุฌุงูุจ ุงูููุจูู ุงููุทุจู
```

## ๐ฏ ููุทู ุงูุนูู:

### 1. **ุงูุชุญูู ูู ุงูููุจูู:**
```dart
// ุฌูุจ ูู API
Stream<Coupon> couponStream = await verifyCoupon(code);

// ุงูุชุญูู ูู ุงูุตุญุฉ
if (!foundCoupon.valid!) return;

// ุงูุชุญูู ูู ุงููุทุนู
bool isValidForRestaurant = foundCoupon.discountables!.any((discountable) =>
  discountable.discountableType == 'App\\Models\\Restaurant' &&
  discountable.discountableId.toString() == currentRestaurantId
);
```

### 2. **ุญุณุงุจ ุงูุฎุตู:**
```dart
if (coupon.discountType == 'fixed') {
  couponDiscount = coupon.discount!; // ุฎุตู ุซุงุจุช
} else if (coupon.discountType == 'percent') {
  couponDiscount = subTotal * (coupon.discount! / 100); // ุฎุตู ูุณุจู
}
```

### 3. **ุชุทุจูู ุงูุฎุตู:**
```dart
total = subTotal + deliveryFee - couponDiscount;
```

## ๐จ ุฑุณุงุฆู ุงูุฎุทุฃ:

- **"ููุจูู ุบูุฑ ุตุงูุญ"**: ุงูููุจูู ุบูุฑ ููุฌูุฏ ุฃู ุบูุฑ ูุนุงู
- **"ูุฐุง ุงูููุจูู ูุง ููุทุจู ุนูู ุงููุทุนู ุงูุญุงูู"**: ุงูููุจูู ููุทุนู ุขุฎุฑ
- **"ุญุฏุซ ุฎุทุฃ ูู ุชุทุจูู ุงูููุจูู"**: ูุดููุฉ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู

## โ ุฑุณุงุฆู ุงููุฌุงุญ:

- **"ุชู ุชุทุจูู ุงูููุจูู ุจูุฌุงุญ! ุฎุตู X ุฏููุงุฑ"**: ููุฎุตู ุงูุซุงุจุช
- **"ุชู ุชุทุจูู ุงูููุจูู ุจูุฌุงุญ! ุฎุตู X%"**: ููุฎุตู ุงููุณุจู

## ๐ ุญู ูุดุงูู ุงูุชุฑุฌูุฉ:

ุฅุฐุง ูุงุฌูุช ุฃุฎุทุงุก ูู ุงูุชุฑุฌูุฉุ ูู ุจุชุดุบูู:
```bash
flutter packages pub run intl_utils:generate
```

## ๐ ุงุฎุชุจุงุฑ ุงููุธุงู:

1. **ููุจูู ุตุญูุญ**: ูุฌุจ ุฃู ูุทุจู ุงูุฎุตู
2. **ููุจูู ุฎุงุทุฆ**: ูุฌุจ ุฃู ูุธูุฑ ุฑุณุงูุฉ ุฎุทุฃ
3. **ููุจูู ููุทุนู ุขุฎุฑ**: ูุฌุจ ุฃู ูุธูุฑ ุฑุณุงูุฉ ุนุฏู ุงูุชุทุจูู
4. **ุฅุฒุงูุฉ ุงูููุจูู**: ูุฌุจ ุฃู ูุฎุชูู ุงูุฎุตู

ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู! ๐
